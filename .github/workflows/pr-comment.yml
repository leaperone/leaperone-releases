name: PR Comment

on:
  workflow_call:
    inputs:
      status:
        required: true
        type: string
      ref:
        required: true
        type: string
      run_number:
        required: true
        type: string
      message:
        required: false
        type: string
      author:
        required: false
        type: string
      run_id:
        required: true
        type: string
      pr_number:
        required: true
        type: string
      repository:
        required: false
        type: string
    secrets:
      ACCESS_TOKEN:
        required: true

jobs:
  comment:
    runs-on: ubuntu-latest
    steps:
      - name: Set author display
        id: set-author
        run: |
          if [ "${{ inputs.status }}" != "success" ] && [ -n "${{ inputs.author }}" ]; then
            echo "author_display=@${{ inputs.author }}" >> $GITHUB_OUTPUT
          else
            echo "author_display=${{ inputs.author }}" >> $GITHUB_OUTPUT
          fi

      - name: Create comment
        uses: peter-evans/create-or-update-comment@v5
        with:
          token: ${{ secrets.ACCESS_TOKEN }}
          repository: ${{ inputs.repository }}
          issue-number: ${{ inputs.pr_number }}
          body: |
            ## ${{ inputs.status == 'success' && 'ğŸš€ æ„å»ºæˆåŠŸå•¦ï¼' || 'âŒ æ„å»ºå¤±è´¥äº†ï¼' }}

            ### ğŸŒŸ æ„å»ºè¯¦æƒ…

            - **åˆ†æ”¯**ï¼š`${{ inputs.ref }}`
            - **æ„å»ºç¼–å·**ï¼š#${{ inputs.run_number }}
            - **æäº¤ä¿¡æ¯**ï¼š${{ inputs.message }}
            - **æäº¤è€…**ï¼š${{ steps.set-author.outputs.author_display }}

            ---

            ${{ inputs.status == 'success' && 'âœ¨ æ„å»ºå·²ç»å®Œæˆï¼Œå¯ä»¥åˆå¹¶ï¼' || 'ğŸ˜± ç³Ÿç³•ï¼æ„å»ºå‡ºç°äº†é—®é¢˜ï¼Œè¯·åŠæ—¶æ£€æŸ¥ï¼' }}

            [æŸ¥çœ‹è¯¦æƒ… ğŸ‘‰](${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ inputs.run_id }})
          reactions: ${{ inputs.status == 'success' && '+1' || 'eyes' }}

